# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: run tests and generate a tag

on:
  push: 
    branches:
      - "github-actions-CI/CD"

jobs:
  upload-to-docker-hub:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Set up Docker Buildx
          uses: docker/setup-buildx-action@v1

        - name: Log in to Docker Hub
          uses: docker/login-action@v1
          with:
            username: ${{ secrets.DOCKER_HUB_USERNAME }}
            password: ${{ secrets.DOCKER_HUB_PASSWORD }}

        - name: Get variables
          id: get_variables
          run: |
            export VERSION="1.0.0"

            echo "javifdez7/programaze:${VERSION}"

        - name: Build and push Docker image
          run: |
            docker buildx create --use
            docker buildx build -t javifdez7/programaze:1.0.0 -f Dockerfile.prod .
            docker push javifdez7/programaze:1.0.0

